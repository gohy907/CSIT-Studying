
Преподаватель: Фёдорова Антонина Гавриловна

При классификации программных средств традиционно их деление на прикладное, проблемное и системное программное обеспечение:
    - Проблемное (прикладное) СПО --- это комплекс программ, предназаченных для решения задач из некоторой узкой области применения вычислительной техники
    - Системное (СПО) --- это комплекс программ, используемый для разработки и исполнения любых программ
        - Управляющие системные программы, которые обеспечивают корректное выполнение всех процессов и функционирование всех устройств вычислительной системы, относятся к ядру операционных систем, постоянно находятся в оперативной памяти и называются резидентными. 
        - Управляющие системные программы, которые загружаются в оперативную память по мере их необходиемости называются транзитными.
    - Обрабатывающие системные программы выполняются как специальные приложения ОС, используемые при создании новых, модификации старых существующих программ. При создании таких программ используются машинно-зависимые языки и языки высокого уровня. Однако эффективность программ, созданных на языках высокого уровня в любом случае будет ниже, чем на любом машинно-ориентированном языке.

Машинно-зависимые языки учитывают особенности архитектуры процессора. Архитектуры процессоров постоянно совершенствуются и развиваются, что значит, что постоянно будут совершенствоваться машинно-ориентированные языки.

Ассемблер --- общее название для языков низкого уровня, зависящих от архитектуры процессора.

На ассемблере пишут всё, что требует максимальной скорости и эффективности выполнения.

## Архитектура ПК

С точки зрения программиста это набор программно доступных средств. Архитектура ПК включает в себя набор блоков и устройств, входящих в вычислительную систему, и функциональную организацию этих блоков и устройств, обеспечивающих автоматическую работу этой системы.

При построении ПК используется магистрально-модульный принцип для системных магистралей и центральной шины с помошью стандартного интерфейса подключается все блоки и устройства.

Шина --- это набор линий связи, по которым информация передаётся от одного из источников к одному или нескольким приёмникам.

Существуют 3 типа шин:
    - Адресная шина
        - Однонаправленная, адреса передаются от центрального процессора
    - Шина данных
        - Двунаправленная, данные передаются и к центральному процессору и от него
    - Шина управления
        - Может быть как однонаправленной, так и двунаправленной линией связи

Центральный процессор работает значительно быстрее внешних устройств, поэтому в архитектуре процессора для обеспечения синхронизации работы всех устройств используется система прерываний. Если какому-либо устройству требуется работа процессора, это устройство посылает процессору специальный сигнал прерывания, который проходит через контроллер прерываний, который определяет приоритет прерывания, и при возможности процессор его обрабатывает, а затем возвращается к выполнению прерванной программы.

Существуют различные типы прерываний и их классификация. Прерывания могут быть внутренними и внешними, маскируемыми и немаскируемыми и т.д.

Поскольку внешние устройства работают намного медленне процессора, для организации параллельной работы процессора и внешних устройств в архитектуру компьютера включены:
    - Канал прямого доступа к памяти
    - Интерфейсные блоки
    - Устройства управления внешними устройствами

## Архитектура микропроцессора ix86

Процессор после включения питания устанавливается в реальный режим адресации памяти и работы процессора, но большинство ОС сразу переводят его в защищённый режим, обеспечивая многозадачность. 

С точки зрения программиста архитектура процессора это набор программно доступных средств.

В 32-разрядном процессоре программисту доступны:
    - 16 регистров общего назначения (основных регистров)
    - 11 регистров для работы с сопроцессором и мультимедийными приложениями
    - И в реальном режиме доступные регистры управления

Будем изучать только 16 регистров общего назначения
    - 4 регистра общего назначения:
        -  EAX, EBX, ECX, EDX на 32-битных процессорах
        - AX, BX, CX, DX на 16-битных процессорах
        - 8 регистров для работы с 8 разрядными данными:
            - AL, AH, BL, BH, CL, CH, DL, DH
    - 6 сегметных регистров:
        - CS, DS, ES, FS, GS, SS
    - Счётчик команд (указатель команд):
        - IP или EIP
    - Регистр флагов 
        - EFLAGS

Регистры общего назначения могут использоваться и для хранения адресов, и для хранения данных, эти регистры имеют собственные имена:
    - AX: аккумулятор, в него чаще всего записывают результат
    - BX: базовый регистр, используется при сложной адресации данных 
    - CX: счётчик, используется при организации циклов при работе со строками
    - DX: регистр данных

Регистры индексов используются при сложной адресации данных, при работе со строками. А регистры SP (stack pointer), BP (base pointer) используются при работе со стеком

Процессор может работать с оперативной памятью как с одним непрерывным массивом байт. Этот режим называется flat.
А может работать на участке, разделённой на много массивов --- сегментов. В этом случае адрес байта состоит из двух частей:
    - Адрес начала сегмента
    - Адрес внутри сегмента (смещение, относительно его начала)

Для получения адреса начала сегмента используются сегметные регистры (селекторы), потому что с каждым селектором связан программно недоступный регистр, называемый дескриптором.

Операционные системы могут размещать сегменты в оперативной памяти случайным образом и даже записывать их на внешние носители, если оперативной памяти не хватает.

При работе процессора в защищённом режиме в дескрипторе содержится адрес начала сегмента, его размер и некоторые характеристики. Размер сегментов в защищённом режиме может достигать 4 Гб. А в реальном режиме размер сегмента фиксирован и равен 64 Кб, и адрес сегмента в 16-ричной системе счисления можно записать как XXXX0, т.е. адрес сегмента кратен 16-ти, и старшие 4 цифры адреса хранятся в сегментном регистре. 

4 первых регистра, OS, FS, ES, GS --- регистры для адресов сегментов данных

Регистр CS (code segment) --- адрес сегмента кода
SS (stack segment) --- адрес сегмента стека

Сегментных регистров всего 6, но это не означает, что программа может использовать только 6 сегментов памяти. Программист может в любой момент изменить содержимое этого регистра и попасть на другой участок памяти

Сегмент стека организован специальным образом так, что при добавлении элемента в стек содержимое указателя на вершину стека уменьшается, т.е. регистр SS ОС автоматически загружает в адрес начала сегмента стека.

Стек растёт от максимально большого значения (SS) с уменьшением значения при добавлении элементов. Такая организация стека реализована, чтобы в режиме flat программы размещались с младших адресов, а стех со старших.

Стек используется для: 
    - Хранения параметров
    - Реализации рекурсивных подпрограмм

Если мы хотим, чтобы в стеке хранились и локальные параметры, то на помощь приходит регистр BP. После загрузки фактических параметров значение указателя на вершину стека SP нужно сохранить в регистре BP, и тогда фактическим параметрам можно будет обращаться BP + k, а к локальным BP - n, где k и n программист сам вычисляет в зависимости от количества и размеров параметров

Регистр команд IP (EIP) содержит в себе смещение для адреса следующей исполняемой команды

Регистр FLAGS или EFLAGS определяет состояние процессора и программы в каждый текущий момент времени с помощью значения флажков, определяемых битами этого регистра:
    - CF --- флаг переноса устанавливается в 1, если при выполнении сложения происходит перенос за разрядную сетку, а при вычитании требуется заём
    - PF --- флаг паритета (чётности) устанавливается в 1, если в младшем байте результата оказывается чётное число единиц
    - AF --- флаг полупереноса устанавливается в 1, если при сложении происходит перенос из 3 разряда в 4, а при вычитании требуется заём из 4 в 3.
    - ZF --- флаг нуля устанавливается в 1, если все биты результата равны 0
    - SF --- флаг знака всегда равен знаковому разряду 
    - TF --- флаг трассировки, установленный в 1 переводит процессор в режим отладки
    - IF --- флаг прерывания, с помощью него можно запретить внешние прерывания
    - DF --- флаг направления, определяет направление обработки строковых данных:
        - Определяет направление обработки строковых данных
        - Если программист установит его в 1, то данные будут передаваться от старших адресов к младшим
        - Если 0, то от младших адресов к старшим (слева направо)
        - При это индексные регистры SI, BI автоматически уменьшаются, если DF = 1, или увеличиваются, если DF = 0, на размер операнда
    -GF --- флаг управления
        - Автоматически устанавливается в 1, если результат превысил максимально допустимый для данной операции
    
Регистры 64-х битного процессора:
 - 16 целочисленных 64-битных регистра общего назначения (RAX, RBX, RCX, RDX, RBP, RSI, RDI, RSP, R8 --- R15),
 - 8 80-битных регистров с плавающей точкой (ST0 -- ST7)
 - 8 64-битных регистров Multimedia Extensions (MM0 -- MM7, имеют общее пространство с регистрами ST0 -- ST7)
 - 16 128-битных регистров SSE (XMM0 -- XMM15),
 - 64-битный указатель RIP и 64-битный регистр флагов RFLAGS

Основные достоинства архитектуры x86-64
- 64-битное адресное пространство
- расширенный набор регистров
- привычный для разработчиков набор команд
- возможность запуска 32-битных приложений в 64-битной ОС
- возможность использования 32-битных ОС

Необходимость 64-битной архитектуры определяется приложениями, которым необходимо большое адресное пространство
В первую очередь это высокопроизводительные серверы, системы управления базами даных, САПР и конечно, игры
Такие приложения получают существенные преимущества от 64-битного адресного пространства и увеличения количества регистров
Малое количество регистров ограничивает производительность в вычислительных задачах, а увеличенное количество регистров обеспечивает достаточную производительность для многих приложений

## Оперативная память

Оперативная память состоит из байтов, каждый байт состоит из информационных битов

32-х разрядный процессор может работать с ОП до 4 Гб и, следовательно, адреса байтов изменяются от 0 до 2^32 -1 (00000000 -- FFFFFFFF_16)

Байты памяти могут объединяться в поля фиксированной и переменной длины
Фиксированная длина -- слово (2 байта), двойное слово (4 байта). Поля переменной длины могут содержать произвольное количество байтов.
Адресом поля является адрес младшего входящего в поле байта. Адрес поля может быть любым
ОП может использоваться как непрерывная последовательность байтов, так и сегментированная

Физический адрес (ФА) байта записывается как:
- <сегмент>: <смещение>
Т. е. он может быть получен по формуле ФА = АС + ИА, где АС -- адрес сегмента, ИА -- исполняемый адрес, т.е. ИА --- <смещение> формируется в команде различными способами в зависимости от способа адресации операндов

В защищённом режиме программа может определить до 16383 сегментов размером до 4 Гб, и таким образом может работать с 64 Тб виртуальной памяти

Для реального режмиа АС определяется сегментным регистром и для получения 20-разрядного двочиного адреса байта необходимо к содержимому сегментного регистра, смещённого на 4 разряда влево, прибавить 16-разрядное смешение --- ИА. Например, адрес следующей исполняемой команды:

$ФА = (CS) + (IP)$
$(CS) = 7A15_{16} = 0111 1010 0001 0101 0000_2$
$(IP) = C7D9_{16} =      1100 0111 1101 1001_2$
$ФА = 86929_{16}  = 1000 0110 1001 0010 1001_2$


## Форматы данных

Процессор ix86 вместе с сопроцессором могут обрабатывать большой набор различных типов данных: целые числа без знака, целые числа со знаком, действительные числа с плавающей точкой, двочино-десятичные числа, символы, строки, указатели.
Целые числа без знака могут занимать байт, слово, двойное слово и принимать значения по умолчанию из диапазонов:
- 0 -- 255 (байт)
- 0 -- 65535 (слово)
- 0 -- 4294967295 (двойное слово)
Целые числа со знаком могут занимать также байт, слово, двойное слово. Они хранятся в дополительном коде. 

Дополнительный код положителного числа равен самому числу.
Дополнительный код отрицательного числа в любой системе счисления может быть получен по формуле: $X = 10^n - |X|$, где n -  разрядность числа.
Например, представим в слове отрицательное 16-ричное число -AC7_16

$10^4 - AC7 = F539$

Дополнительный код двоичного числа может быть получен инверсией разрядов и прибавлением 1 к младшему разряду, например, -12 в байте:
	$12 = 00001100_2$
	Инверсия --- $11110011_2$
	Дополнительный код --- $11110100_2$

Рассмотрим выполнение операции вычитания в машине: дополнительный код вычитаемого прибавляется к уменьшаемому
Напрмер: $65 - 42 = 23$
	$64 = 01000001_2$
	$42 = 00101010_2$
	$-42 = 11010110_2$
	$65 + (-42) = 00010111_2 = 23_{10}$

Числа с плавающей точкой могут занимать:
- 32 бит --- короткое вещественное
- 64 бит --- длинное вещественное
- 80 бит --- рабочее вещественное
Формат числа с плавающей точкой состоит из трёх полей:
- <знак числа>
- <машинный порядок>
- <мантисса>


| Вещественное | Знак числа | Машинный порядок | Мантисса |                          |
| ------------ | ---------- | ---------------- | -------- | ------------------------ |
| Короткое     | 1          | 8                | 23       | -10^+-32 -- 10^+-32      |
| Длинное      | 1          | 11               | 52       | -10^+--308 -- 10^+-308   |
| Рабочее      | 1          | 15               | 64       | - 10^+-4592 -- 10^+-4592 |

Машинный порядок ($Пм$) включает в себя неявным образом знак порядка и связан с истинным порядком ($Пи$) формулой:

$Пм= Пи + 127_{10} (1023_{10}, 16383_{10})$

Предполагается, что манитсса нормализлована и старший единичный рязряд мантиссы не помещается в разрядную сетку.

Пример, $3060_{10}$ представим в виде числа с плавающей точкой, занимающего 4 байта
	$3060_{10} = BF4_{16}$
	Нормализуем число $(0 <= |M| < 1) - 0.BF4\*10^3_16$
	Получим машинный порядок Пм = 3_16 + 7F_16
	Записываем в разрядную сетку в 2-ичной системе счисления:
	`0 1000 0010 011 1111 0100 0000 0000 0000_2`
	Или в 16-ричном виде: 413F4000_16
	0100 001 0 011 1111 0100 0000 0000 0000_2
Двоично-десятичные данные процессором могут обрабатываться 8-ми разрядные в упакованном и неупакованном формате, и сопроцессором могут обрабаываться 80-ти разрядные даные, и сопроцессором могут обрабатываться 80-ти разрядные данных в упакованном формате. Упакованный формат предполагает хранение двух цифр в байте, а неупакованный --- хранит оддну цифру

Символьные данные --- символы в коде ASCII. Для любого символа отводится один байт. 
Строковые данные --- это последовательность байт, слов или двойных слов.
Указатели, существуют два типа указателей:
- Длинный указатель, занимающий 48 бит --- селектор (16 бит) + смещение (32 бит)
- Короткий указатель, занимающий 32 бита --- только смещение